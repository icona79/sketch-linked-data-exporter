var globalThis=this,global=this;function __skpm_run(e,t){globalThis.context=t;try{var r=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){var n=r(12).Buffer,a=r(13),o=a.parseStat,i=a.fsError,l=a.fsErrorForPath,s=a.encodingFromOptions,c=a.NOT_IMPLEMENTED;e.exports.constants={F_OK:0,R_OK:4,W_OK:2,X_OK:1},e.exports.access=c("access"),e.exports.accessSync=function(t,r){r|=0;var n=NSFileManager.defaultManager();switch(r){case 0:canAccess=e.exports.existsSync(t);break;case 1:canAccess=Boolean(Number(n.isExecutableFileAtPath(t)));break;case 2:canAccess=Boolean(Number(n.isWritableFileAtPath(t)));break;case 3:canAccess=Boolean(Number(n.isExecutableFileAtPath(t)))&&Boolean(Number(n.isWritableFileAtPath(t)));break;case 4:canAccess=Boolean(Number(n.isReadableFileAtPath(t)));break;case 5:canAccess=Boolean(Number(n.isReadableFileAtPath(t)))&&Boolean(Number(n.isExecutableFileAtPath(t)));break;case 6:canAccess=Boolean(Number(n.isReadableFileAtPath(t)))&&Boolean(Number(n.isWritableFileAtPath(t)));break;case 7:canAccess=Boolean(Number(n.isReadableFileAtPath(t)))&&Boolean(Number(n.isWritableFileAtPath(t)))&&Boolean(Number(n.isExecutableFileAtPath(t)))}if(!canAccess)throw new Error("Can't access "+String(t))},e.exports.appendFile=c("appendFile"),e.exports.appendFileSync=function(t,r,a){if(!e.exports.existsSync(t))return e.exports.writeFileSync(t,r,a);var o=NSFileHandle.fileHandleForWritingAtPath(t);o.seekToEndOfFile();var i=s(a,"utf8"),l=n.from(r,"NSData"===i||"buffer"===i?void 0:i).toNSData();o.writeData(l)},e.exports.chmod=c("chmod"),e.exports.chmodSync=function(e,t){var r=MOPointer.alloc().init();if(NSFileManager.defaultManager().setAttributes_ofItemAtPath_error({NSFilePosixPermissions:t},e,r),null!==r.value())throw l(e,void 0,r.value())},e.exports.chown=c("chown"),e.exports.chownSync=c("chownSync"),e.exports.close=c("close"),e.exports.closeSync=c("closeSync"),e.exports.copyFile=c("copyFile"),e.exports.copyFileSync=function(e,t,r){var n=MOPointer.alloc().init();if(NSFileManager.defaultManager().copyItemAtPath_toPath_error(e,t,n),null!==n.value())throw l(e,!1,n.value())},e.exports.createReadStream=c("createReadStream"),e.exports.createWriteStream=c("createWriteStream"),e.exports.exists=c("exists"),e.exports.existsSync=function(e){var t=NSFileManager.defaultManager();return Boolean(Number(t.fileExistsAtPath(e)))},e.exports.fchmod=c("fchmod"),e.exports.fchmodSync=c("fchmodSync"),e.exports.fchown=c("fchown"),e.exports.fchownSync=c("fchownSync"),e.exports.fdatasync=c("fdatasync"),e.exports.fdatasyncSync=c("fdatasyncSync"),e.exports.fstat=c("fstat"),e.exports.fstatSync=c("fstatSync"),e.exports.fsync=c("fsync"),e.exports.fsyncSync=c("fsyncSync"),e.exports.ftruncate=c("ftruncate"),e.exports.ftruncateSync=c("ftruncateSync"),e.exports.futimes=c("futimes"),e.exports.futimesSync=c("futimesSync"),e.exports.lchmod=c("lchmod"),e.exports.lchmodSync=c("lchmodSync"),e.exports.lchown=c("lchown"),e.exports.lchownSync=c("lchownSync"),e.exports.link=c("link"),e.exports.linkSync=function(e,t){var r=MOPointer.alloc().init();if(NSFileManager.defaultManager().linkItemAtPath_toPath_error(e,t,r),null!==r.value())throw l(e,void 0,r.value())},e.exports.lstat=c("lstat"),e.exports.lstatSync=function(e){var t=MOPointer.alloc().init(),r=NSFileManager.defaultManager().attributesOfItemAtPath_error(e,t);if(null!==t.value())throw l(e,void 0,t.value());return o(r)},e.exports.mkdir=c("mkdir"),e.exports.mkdirSync=function(e,t){var r=511,n=!1;t&&t.mode&&(r=t.mode),t&&t.recursive&&(n=t.recursive),"number"==typeof t&&(r=t);var a=MOPointer.alloc().init();if(NSFileManager.defaultManager().createDirectoryAtPath_withIntermediateDirectories_attributes_error(e,n,{NSFilePosixPermissions:r},a),null!==a.value())throw new Error(a.value())},e.exports.mkdtemp=c("mkdtemp"),e.exports.mkdtempSync=function(t){var r=t+function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<6;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}();return e.exports.mkdirSync(r),r},e.exports.open=c("open"),e.exports.openSync=c("openSync"),e.exports.read=c("read"),e.exports.readdir=c("readdir"),e.exports.readdirSync=function(e,t){for(var r=s(t,"utf8"),a=NSFileManager.defaultManager().subpathsAtPath(e),o=[],i=0;i<a.length;i++){var l=a[i];o.push("buffer"===r?n.from(l):String(l))}return o},e.exports.readFile=c("readFile"),e.exports.readFileSync=function(e,t){var r=s(t,"buffer"),a=NSFileManager.defaultManager().contentsAtPath(e);if(!a)throw l(e,!1);var o=n.from(a);return"buffer"===r?o:"NSData"===r?o.toNSData():o.toString(r)},e.exports.readlink=c("readlink"),e.exports.readlinkSync=function(e){var t=MOPointer.alloc().init(),r=NSFileManager.defaultManager().destinationOfSymbolicLinkAtPath_error(e,t);if(null!==t.value())throw l(e,void 0,t.value());return String(r)},e.exports.readSync=c("readSync"),e.exports.realpath=c("realpath"),e.exports.realpath.native=c("realpath.native"),e.exports.realpathSync=function(e){return String(NSString.stringWithString(e).stringByResolvingSymlinksInPath())},e.exports.realpathSync.native=c("realpathSync.native"),e.exports.rename=c("rename"),e.exports.renameSync=function(e,t){var r=MOPointer.alloc().init(),n=NSFileManager.defaultManager();n.moveItemAtPath_toPath_error(e,t,r);var a=r.value();if(null!==a){if("NSCocoaErrorDomain"!==String(a.domain())||516!==Number(a.code()))throw l(e,void 0,a);var o=MOPointer.alloc().init();if(n.replaceItemAtURL_withItemAtURL_backupItemName_options_resultingItemURL_error(NSURL.fileURLWithPath(t),NSURL.fileURLWithPath(e),null,NSFileManagerItemReplacementUsingNewMetadataOnly,null,o),null!==o.value())throw l(e,void 0,o.value())}},e.exports.rmdir=c("rmdir"),e.exports.rmdirSync=function(t){var r=MOPointer.alloc().init(),n=NSFileManager.defaultManager();if(!e.exports.lstatSync(t).isDirectory())throw i("ENOTDIR",{path:t,syscall:"rmdir"});if(n.removeItemAtPath_error(t,r),null!==r.value())throw l(t,!0,r.value(),"rmdir")},e.exports.stat=c("stat"),e.exports.statSync=function(t){return e.exports.lstatSync(e.exports.realpathSync(t))},e.exports.symlink=c("symlink"),e.exports.symlinkSync=function(e,t){var r=MOPointer.alloc().init();NSFileManager.defaultManager().createSymbolicLinkAtPath_withDestinationPath_error(t,e,r);if(null!==r.value())throw new Error(r.value())},e.exports.truncate=c("truncate"),e.exports.truncateSync=function(e,t){var r=NSFileHandle.fileHandleForUpdatingAtPath(sFilePath);r.truncateFileAtOffset(t||0),r.closeFile()},e.exports.unlink=c("unlink"),e.exports.unlinkSync=function(t){var r=MOPointer.alloc().init(),n=NSFileManager.defaultManager();if(e.exports.lstatSync(t).isDirectory())throw i("EPERM",{path:t,syscall:"unlink"});n.removeItemAtPath_error(t,r);if(null!==r.value())throw l(t,!1,r.value())},e.exports.unwatchFile=c("unwatchFile"),e.exports.utimes=c("utimes"),e.exports.utimesSync=function(e,t,r){var n=MOPointer.alloc().init();NSFileManager.defaultManager().setAttributes_ofItemAtPath_error({NSFileModificationDate:t},e,n);if(null!==n.value())throw l(e,void 0,n.value())},e.exports.watch=c("watch"),e.exports.watchFile=c("watchFile"),e.exports.write=c("write"),e.exports.writeFile=c("writeFile"),e.exports.writeFileSync=function(e,t,r){var a=s(r,"utf8");n.from(t,"NSData"===a||"buffer"===a?void 0:a).toNSData().writeToFile_atomically(e,!0)},e.exports.writeSync=c("writeSync")},function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(4),a=r(5),o=r(6),i=r(8);e.exports=function(e,t){return n(e)||a(e,t)||o(e,t)||i()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),o=r(2),i=r.n(o);function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw o}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=r(9),u=(r(10),c.getSelectedDocument()),p="data";u.path&&(p=(p=(p=v(u.path.split("/").reverse()[0])).replace(".sketchcloud","")).replace(".sketch",""));r(11).isNativeObject;var f=r(0),m=r(14),y=r(15),d=(y.join(m.homedir(),"Desktop"),y.join(m.homedir(),"Library/Application Support/com.bohemiancoding.sketch3")+"/Linked-Data");x(d);var S=d+"/Data-"+p,h=S+"/Images";x(S),x(h);function x(e){try{f.existsSync(e)||f.mkdirSync(e)}catch(t){console.error(t)}}function v(e){return e=(e=(e=(e=(e=e.replace(/\s/g,"-")).replace(/\_+/g,"-")).replace(/\/+/g,"-")).replace(/%20+/g,"-")).replace(/\-+/g,"-").toLowerCase()}t.default=function(){var e={},t=u.selectedLayers.layers[0];if(u.selectedLayers.isEmpty)c.UI.message("Please select at least 1 layer.");else if(u.selectedLayers>1)c.UI.message("Please select maximum 1 layer.");else if("Group"===t.type||"SymbolInstance"===t.type||"SymbolMaster"===t.type){for(var r=[],n=0;n<u.selectedLayers.length;n++){var o=b(u.selectedLayers.layers[n]);o&&Object.keys(o).length>0&&r.push(o)}var s=v(t.name)+".json";if(S){var p=Object.values(e);p.length>0&&p.forEach((function(e){!function(e,t){NSBitmapImageRep.imageRepWithData(e.nsdata).representationUsingType_properties(NSBitmapImageFileTypePNG,{}).writeToFile_atomically(t,"YES")}(e.layer,h+"/"+String(e.name)+".png")}))}if(void 0===o)message("☝️ No symbol overrides found.");else{var m=JSON.stringify([o],null,2);if(0===m.length)return void c.UI.message("No data found.");try{var y=S+"/"+s;f.writeFileSync(y,m),c.UI.message("✅ Link Data extraction complete");var d=NSURL.fileURLWithPath(y),x=AppController.sharedInstance().dataSupplierManager();if(x.canAddLocalDataGroupWithURL(d)){var g=MSLocalDataSupplierGroup.localDataSupplierGroupFromFileSystemURL_dataSupplierDelegate_error_(d,x,nil);g&&x.addLocalDataSupplierGroup(g)}}catch(N){c.UI.message("⛔️ There was an error writing your file on Desktop")}}}else c.UI.message("Please select a Group, a Symbol Instance or a Symbol Source.");function b(t){var r={},n=t.getParentPage();if("SymbolInstance"==t.type||"SymbolMaster"==t.type){var o,s={"":r},c=l(t.overrides.filter((function(e){return e.editable&&["symbolID","stringValue","image"].includes(e.property)})));try{for(c.s();!(o=c.n()).done;){var u=o.value,p=u.path.split("/");p.pop();var f=p.join("/");if("symbolID"!=u.property)if("image"==u.property){var m=String(u.value.id),y={};y.name=v(u.affectedLayer.name)+"-"+m,y.layer=u.value,y.parent=n,e[m]||(e[m]=y),s[f][u.affectedLayer.name]="images/"+v(u.affectedLayer.name)+"-"+m+".png"}else s[f][u.affectedLayer.name]=u.value;else s[u.path]={},s[f]&&(s[f][u.affectedLayer.name]=s[u.path])}}catch(w){c.e(w)}finally{c.f()}}else{if("Group"!=t.type)return null;var d,S=l(Array.from(t.layers).reverse());try{for(S.s();!(d=S.n()).done;){var h=d.value;if("Group"==h.type||"SymbolInstance"==h.type)r[h.name]=b(h);else if("Text"==h.type)r[h.name]=h.text;else if("Image"==h.type){m=String(h.image.id);var x={};x.name=v(h.name)+"-"+m,x.layer=h.image,x.parent=n,e[m]||(e[m]=x),r[h.name]="images/"+v(h.name)+"-"+m+".png"}else{var g,N=null===(g=h.style)||void 0===g?void 0:g.fills.reduce((function(e,t){return"Pattern"!==t.fillType?e:t.pattern.image}),null);if(!N)break;m=String(N);var F={};F.name=h.name+"-"+m,F.layer=N,F.parent=n,e[m]||(e[m]=F),r[h.name]="images/"+h.name+"-"+m+".png"}}}catch(w){S.e(w)}finally{S.f()}}return r=function e(t){var r=!1;return Object.entries(t).forEach((function(n){var o=i()(n,2),l=o[0],s=o[1];0===Object.keys(s).length?(delete t[l],r=!0):"object"===a()(s)&&(t[l]=e(s))})),r?e(t):t}(r)}}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(s){l=!0,a=s}finally{try{i||null==r.return||r.return()}finally{if(l)throw a}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(7);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=require("sketch")},function(e,t){e.exports=require("sketch/data-supplier")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("buffer")},function(e,t,r){e.exports.parseStat=function(e){return{dev:String(e.NSFileDeviceIdentifier),mode:e.NSFileType|e.NSFilePosixPermissions,nlink:Number(e.NSFileReferenceCount),uid:String(e.NSFileOwnerAccountID),gid:String(e.NSFileGroupOwnerAccountID),size:Number(e.NSFileSize),atimeMs:1e3*Number(e.NSFileModificationDate.timeIntervalSince1970()),mtimeMs:1e3*Number(e.NSFileModificationDate.timeIntervalSince1970()),ctimeMs:1e3*Number(e.NSFileModificationDate.timeIntervalSince1970()),birthtimeMs:1e3*Number(e.NSFileCreationDate.timeIntervalSince1970()),atime:new Date(1e3*Number(e.NSFileModificationDate.timeIntervalSince1970())+.5),mtime:new Date(1e3*Number(e.NSFileModificationDate.timeIntervalSince1970())+.5),ctime:new Date(1e3*Number(e.NSFileModificationDate.timeIntervalSince1970())+.5),birthtime:new Date(1e3*Number(e.NSFileCreationDate.timeIntervalSince1970())+.5),isBlockDevice:function(){return e.NSFileType===NSFileTypeBlockSpecial},isCharacterDevice:function(){return e.NSFileType===NSFileTypeCharacterSpecial},isDirectory:function(){return e.NSFileType===NSFileTypeDirectory},isFIFO:function(){return!1},isFile:function(){return e.NSFileType===NSFileTypeRegular},isSocket:function(){return e.NSFileType===NSFileTypeSocket},isSymbolicLink:function(){return e.NSFileType===NSFileTypeSymbolicLink}}};var n={EPERM:{message:"operation not permitted",errno:-1},ENOENT:{message:"no such file or directory",errno:-2},EACCES:{message:"permission denied",errno:-13},ENOTDIR:{message:"not a directory",errno:-20},EISDIR:{message:"illegal operation on a directory",errno:-21}};function a(e,t){var r=new Error(e+": "+n[e].message+", "+(t.syscall||"")+(t.path?" '"+t.path+"'":""));return Object.keys(t).forEach((function(e){r[e]=t[e]})),r.code=e,r.errno=n[e].errno,r}e.exports.fsError=a,e.exports.fsErrorForPath=function(e,t,n,o){var i=NSFileManager.defaultManager();if(!i.fileExistsAtPath(e))return a("ENOENT",{path:e,syscall:o||"open"});if(!i.isReadableFileAtPath(e))return a("EACCES",{path:e,syscall:o||"open"});if(void 0!==t){var l=r(0).lstatSync(e).isDirectory();if(l&&!t)return a("EISDIR",{path:e,syscall:o||"read"});if(!l&&t)return a("ENOTDIR",{path:e,syscall:o||"read"})}return new Error(n||"Unknown error while manipulating "+e)},e.exports.encodingFromOptions=function(e,t){return e&&e.encoding?String(e.encoding):e?String(e):t},e.exports.NOT_IMPLEMENTED=function(e){return function(){throw new Error("fs."+e+" is not implemented yet. If you feel like implementing it, any contribution will be gladly accepted on https://github.com/skpm/fs")}}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")}]);if("default"===e&&"function"==typeof r)r(t);else{if("function"!=typeof r[e])throw new Error('Missing export named "'+e+'". Your command should contain something like `export function " + key +"() {}`.');r[e](t)}}catch(n){if("undefined"==typeof process||!process.listenerCount||!process.listenerCount("uncaughtException"))throw n;process.emit("uncaughtException",n,"uncaughtException")}}globalThis.onRun=__skpm_run.bind(this,"default"),globalThis.onShutdown=__skpm_run.bind(this,"onShutdown");